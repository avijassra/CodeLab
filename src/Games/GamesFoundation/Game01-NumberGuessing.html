<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>Game 01 - Number Guessing</title>
	</head>
	<body>
		<div id="output">I am thinking of a number between 0 and 99.</div>
		<input id="input" type="text" placeholder="Enter your guess..." autofocus>
		<button id="guess">guess</button>
		<button id="restart">restart</button>

		<script type="text/javascript">
			// variables
			var mysteryNumber = Math.floor(Math.random() * 100),
				playersGuess = 0,
				allowedAttempts = 10,
				usedAttempts = 0,
				input = document.querySelector('#input'),
				output = document.querySelector('#output'),
				guessBtn = document.querySelector('#guess'),
				restartBtn = document.querySelector('#restart'),
				msg = '<span>{0}</span><br ><span>Attempts made: {1} | Attempts left: {2}</span>';
				
			// button cursor style
			guessBtn.style.cursor = "pointer";
			restartBtn.style.cursor = "pointer";
			
			// window enter key event binding
			bindWindowKeyDownEvent();
			
			// guess button event binding
			guessBtn.addEventListener('click', function(e) {
				validateAndPlay();
			}, false);
			
			// restart button event binding
			restart.addEventListener('click', function(e) {
				var disabled = guessBtn.getAttribute('disabled'),
					proceed = true;
				
				if(disabled !== 'disabled') {
					proceed = confirm('Are you SURE !!!');
				}
				
				if (proceed) {
					startNewGame();
				}
			}, false);
			
			function startNewGame() {
				usedAttempts = 0;
				output.innerText = "I am thinking of a number between 0 and 99.";
				input.value = "";
				guessBtn.removeAttribute('disabled');
				bindWindowKeyDownEvent();
			}
			
			function bindWindowKeyDownEvent() {
				// window enter key event binding
				window.addEventListener('keydown', function(e) {
					if (e.keyCode === 13) {
						validateAndPlay();
					}
				}, false);
			}
			
			function validateAndPlay() {
				playersGuess = parseInt(input.value);
				if (isNaN(playersGuess)) {
					alert('Please enter only numeric values');
				} else {
					playGame();
				}
			}
				
			function playGame() {
				usedAttempts++;
				
				if (usedAttempts === allowedAttempts || playersGuess === mysteryNumber) { 
					endGame();
				} else {
					if(playersGuess > mysteryNumber) {
						output.innerHTML = stringFormat(msg, "Too high", usedAttempts, (allowedAttempts - usedAttempts));
					} else {
						output.innerHTML = stringFormat(msg, "Too low", usedAttempts, (allowedAttempts - usedAttempts));
					}
				}
			}
			
			function endGame() {
				var text;
				
				if (playersGuess === mysteryNumber) {
					text = "<span><p style='font-weight:bold;color:Green;display:inline;'>You got it !!!</p></span><br ><span>With " + (allowedAttempts - usedAttempts) + " of attempts left</span>";
				} else {
					text = "<span>You have used all the " + allowedAttempts + " attempts to guess the number. </span><br ><span>The mystery number was<p style='font-weight:bold;color:Red;display:inline;'>" + mysteryNumber + "</p></span>";
				}
				
				output.innerHTML = text;
				guessBtn.setAttribute('disabled', 'disabled');
				window.removeEventListener('keydown');
			}
			
			function stringFormat() {
				var str = arguments[0];
			
				if (arguments.length > 1) {
					for (var i = 1, j = 0; i < arguments.length; i++, j++) {
						while (str.indexOf('{' + j + '}') >= 0) {
							str = str.replace('{' + j + '}', arguments[i]);
						}
					}
				}
				return str;
			}
		</script>
	</body>
</html>